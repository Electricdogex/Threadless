<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Threadless · ALPHA</title>

<!-- Inline favicon (updated to green/orange) -->
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%230e1613'/%3E%3Cpath d='M16 20h32M16 32h32M16 44h32' stroke='%23ff8b3d' stroke-width='6' stroke-linecap='round'/%3E%3C/svg%3E">

<style>
  /* === Theme: dark green + dark orange === */
  :root{
    --bg:#0e1613;
    --card:#122019;
    --ink:#e9f5ee;
    --muted:#9db7ab;
    --line:#1e2e27;
    --accent:#ff8b3d;
    --accent-2:#1f9d68;
    --accent-2-ink:#06120d;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:
      radial-gradient(1200px 600px at 20% -10%, #15231d 0%, transparent 60%),
      radial-gradient(1000px 800px at 120% -20%, #1a2b23 0%, transparent 55%),
      var(--bg);
    color:var(--ink);
    font:16px/1.5 system-ui, Segoe UI, Inter, Arial, sans-serif;
  }

  header{
    position:sticky; top:0; z-index:3;
    background:linear-gradient(180deg, rgba(18,32,25,.8), rgba(18,32,25,0));
    backdrop-filter: blur(6px);
    border-bottom:1px solid var(--line);
  }

  .wrap{max-width:860px;margin:0 auto;padding:16px}

  h1{margin:0 0 4px; font-size:22px; letter-spacing:.2px}
  .sub{color:var(--muted);font-size:13px}

  .topbar{display:flex; align-items:center; justify-content:space-between; gap:12px}

  .brand{display:flex; align-items:center; gap:12px}

  .logo{
    width:32px;height:32px;border-radius:10px;
    background:#0e1613;border:1px solid var(--line);
    display:grid; place-items:center;
  }
  .logo::after{
    content:''; display:block; width:24px; height:6px; border-radius:6px;
    background:var(--accent);
    box-shadow:0 12px 0 var(--accent), 0 24px 0 var(--accent);
    transform:translateY(-6px);
  }

  .alpha{
    font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:.8px;
    color:var(--accent-2-ink);
    background:linear-gradient(180deg, #27b278, #198657);
    border:1px solid #136d46;
    border-radius:999px;
    padding:6px 10px;
    box-shadow:0 4px 14px rgba(31,157,104,.25), inset 0 1px 0 rgba(255,255,255,.05);
  }

  .pill{font-size:12px;color:var(--muted)}

  .composer{
    margin:16px 0;padding:12px;
    background:var(--card);
    border:1px solid var(--line);
    border-radius:16px;
  }
  textarea{
    width:100%;min-height:110px;
    background:#0b1410;color:var(--ink);
    border:1px solid #243b2f;
    border-radius:12px;padding:12px;resize:vertical;outline:none;
  }
  textarea:focus{
    border-color:#2b5a47;
    box-shadow:0 0 0 4px rgba(31,157,104,.15);
  }

  .row{display:flex;gap:12px;align-items:center;margin-top:10px}

  .btn{
    border:0;border-radius:12px;padding:10px 14px;
    background:linear-gradient(180deg,var(--accent),#e5752d);
    color:#27160a;font-weight:800;cursor:pointer;
  }
  .btn[disabled]{opacity:.55;cursor:not-allowed}

  .meta{margin-left:auto;color:var(--muted);font-size:12px}

  .feed{display:flex;flex-direction:column;gap:12px;margin:20px 0}
  .post{
    padding:14px 14px 10px;
    background:linear-gradient(180deg, rgba(255,139,61,.05), transparent 35%), var(--card);
    border:1px solid var(--line);
    border-radius:16px;
  }
  .content{white-space:pre-wrap;word-wrap:break-word}
  .time{margin-top:8px;color:var(--muted);font-size:12px}

  .notice{margin-top:8px;color:#ffd08f;font-size:12px}
  a{color:var(--accent);text-decoration:none}

  footer{
    color:var(--muted);
    font-size:12px;
    margin:36px 0;
    text-align:center;
  }
  footer .copyright{margin-top:8px;color:var(--muted);font-size:11px}
</style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="topbar">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <h1>Threadless</h1>
            <div class="sub">A single, continuous anonymous board · <strong>ALPHA PROTOTYPE</strong></div>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:10px;">
          <span class="alpha">Alpha Prototype</span>
          <span class="pill" id="status">connecting…</span>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="composer">
      <textarea id="text" maxlength="1000" placeholder="Share a thought… (Enter to post, Shift+Enter = newline)"></textarea>
      <div class="row">
        <button class="btn" id="postBtn">Post</button>
        <div class="meta"><span id="count">0</span>/1000 • cooldown: <span id="cool">0</span>s</div>
      </div>
      <div class="notice">Be civil. Don’t post illegal or harmful content. Everything here is public. This is an <strong>alpha</strong>—content may be lost.</div>
    </section>

    <section class="feed" id="feed"></section>

    <footer>
      <div>Tip: open in two tabs to see realtime updates. Posts are immutable in this MVP.</div>
      <div class="copyright">© 2022–2025 Chrome Gear Software</div>
    </footer>
  </main>

  <!-- Supabase client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://hqwerxoapoczigetylfj.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhxd2VyeG9hcG9jemlnZXR5bGZqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyNTIyNTQsImV4cCI6MjA3MTgyODI1NH0.-MGwuD5NzuHo23GrYD-GsSdeGKoVh_ggDGqp0v7eXoo";
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const statusEl=document.getElementById('status');
    const textEl=document.getElementById('text');
    const postBtn=document.getElementById('postBtn');
    const feedEl=document.getElementById('feed');
    const countEl=document.getElementById('count');
    const coolEl=document.getElementById('cool');

    const COOLDOWN_SEC=15;
    const sleep=ms=>new Promise(r=>setTimeout(r,ms));
    const nowSec=()=>Math.floor(Date.now()/1000);
    function getCooldownLeft(){const last=Number(localStorage.getItem('lastPostTs')||'0');return Math.max(0,(last+COOLDOWN_SEC)-nowSec());}
    function setJustPosted(){localStorage.setItem('lastPostTs', String(nowSec()));}
    function sanitize(s){return s.trim();}

    function renderPost(row){
      const el=document.createElement('div');
      el.className='post';
      el.innerHTML=`<div class="content"></div><div class="time">${new Date(row.created_at).toLocaleString()} · anon</div>`;
      el.querySelector('.content').textContent=row.content;
      return el;
    }

    async function loadRecent(){
      const { data, error }=await sb.from('posts').select('*').order('created_at',{ascending:false}).limit(100);
      if(error){console.error(error);statusEl.textContent='load error';return;}
      feedEl.innerHTML='';data.forEach(r=>feedEl.appendChild(renderPost(r)));
    }

    async function subscribeRealtime(){
      sb.channel('threadless')
        .on('postgres_changes',{event:'INSERT',schema:'public',table:'posts'},p=>{
          feedEl.prepend(renderPost(p.new));
        })
        .subscribe((state)=>{
          statusEl.textContent=(state==='SUBSCRIBED')?'online':state.toLowerCase();
        });
    }

    async function post(){
      const left=getCooldownLeft();
      if(left>0){coolEl.textContent=left;return;}
      const content=sanitize(textEl.value);
      if(!content)return;
      postBtn.disabled=true;
      try{
        const { error }=await sb.from('posts').insert({ content });
        if(error)throw error;
        textEl.value='';countEl.textContent='0';setJustPosted();
      }catch(e){alert('Post failed (see console).');console.error(e);}
      finally{postBtn.disabled=false;}
    }

    textEl.addEventListener('input',()=>{countEl.textContent=textEl.value.length;});
    textEl.addEventListener('keydown',(e)=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();post();}});
    postBtn.addEventListener('click',post);

    (async function tick(){while(true){coolEl.textContent=getCooldownLeft();await sleep(500);}})();
    (async function main(){statusEl.textContent='connecting…';await loadRecent();await subscribeRealtime();})();
  </script>
</body>
</html>
